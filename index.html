<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Greatness League v3.1</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Poppins,sans-serif;background:#06111a;color:#fff;text-align:center}
h1{color:#00eaff;text-shadow:0 0 10px #00eaff}
.container{max-width:950px;margin:auto;padding:10px}
#calendar{display:grid;grid-template-columns:repeat(9,1fr);gap:6px;margin:20px auto}
.card{background:#0e1f2f;border:1px solid #00eaff30;border-radius:8px;padding:8px;cursor:pointer;transition:.3s}
.card:hover{transform:scale(1.05)}
.finalized{box-shadow:0 0 8px #00eaff80}
button{background:linear-gradient(90deg,#ff0080,#7928ca);border:none;color:#fff;border-radius:20px;padding:6px 12px;margin:4px;cursor:pointer;font-weight:600}
#popup{position:absolute;background:#001726ee;border:1px solid #00eaff;border-radius:8px;padding:12px;display:none;z-index:20;width:230px;text-align:left}
input[type=number]{width:60px;text-align:center;border:none;border-radius:4px}
.section{margin:6px 0}
#chartContainer{width:90%;margin:20px auto;display:none}
canvas{background:#111;border-radius:10px}
/* --- PLAYER CARD --- */
#playerCard{background:#0b1926;border:1px solid #00eaff30;border-radius:10px;padding:15px;width:85%;margin:auto;text-align:left}
.statRow{display:flex;justify-content:space-between;padding:2px 0;border-bottom:1px solid #00eaff15}
.statValue{font-weight:600;color:#00ffcc}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ’ Greatness League â€“ 90 Day Tracker v3.1</h1>

<div>
<button onclick="addHabit()">â• Add Habit</button>
<button onclick="addBehavior()">â• Add Behavior</button>
<button onclick="toggleChart()">ğŸ“ˆ Chart</button>
<button onclick="resetData()">ğŸ—‘ Reset</button>
</div>

<div id="habitList"></div>
<div id="behaviorList"></div>
<div id="calendar"></div>
<div id="popup"></div>

<!-- ğŸ§Š PLAYER STATS CARD -->
<div id="playerCard">
<h3>Player Stats Card</h3>
<div class="statRow"><span>Days Completed</span><span class="statValue" id="daysDone">0 / 90</span></div>
<div class="statRow"><span>Avg Pat Riley Score</span><span class="statValue" id="avgScore">0.00</span></div>
<div class="statRow"><span>Avg Goal Score</span><span class="statValue" id="avgGoal">0.00</span></div>
<div class="statRow"><span>Total Habits Checked</span><span class="statValue" id="totalHabits">0</span></div>
<div class="statRow"><span>Total Mistakes</span><span class="statValue" id="totalMistakes">0</span></div>
</div>

<div id="chartContainer"><canvas id="progressChart" height="200"></canvas></div>
</div>

<script>
const totalDays=90;
let habits=JSON.parse(localStorage.getItem("habits")||"[]");
let behaviors=JSON.parse(localStorage.getItem("behaviors")||"[]");
let days=JSON.parse(localStorage.getItem("days")||"[]");
if(days.length===0){for(let i=1;i<=totalDays;i++)days.push({id:i,checks:[],mistakes:[],goalAvg:0,score:0,finalized:false});}
let chart;

/* RENDER */
function renderLists(){
 const h=document.getElementById("habitList"),b=document.getElementById("behaviorList");
 h.innerHTML="<h3>âœ… Habits</h3>"+habits.map((x,i)=>`<div>${x} <button onclick='delHabit(${i})'>ğŸ—‘ï¸</button></div>`).join("");
 b.innerHTML="<h3>âŒ Behaviors</h3>"+behaviors.map((x,i)=>`<div>${x} <button onclick='delBehavior(${i})'>ğŸ—‘ï¸</button></div>`).join("");
}
function renderCalendar(){
 const cal=document.getElementById("calendar");cal.innerHTML="";
 days.forEach(d=>{
   const el=document.createElement("div");
   el.className="card"+(d.finalized?" finalized":"");
   el.style.background=colorByScore(d.score);
   el.innerHTML=`Day ${d.id}`;
   el.onclick=e=>openPopup(e,d.id);
   cal.appendChild(el);
 });
 updatePlayerCard();
}
function colorByScore(s){if(s>0.7)return"#007a00b0";if(s>0.4)return"#999900b0";if(s>0)return"#7a0000b0";return"#0e1f2f";}

/* ADD / DELETE */
function addHabit(){const n=prompt("Habit name:");if(!n)return;habits.push(n);days.forEach(d=>d.checks.push(false));save();renderLists();}
function addBehavior(){const n=prompt("Behavior name:");if(!n)return;behaviors.push(n);days.forEach(d=>d.mistakes.push(false));save();renderLists();}
function delHabit(i){habits.splice(i,1);days.forEach(d=>d.checks.splice(i,1));save();renderLists();}
function delBehavior(i){behaviors.splice(i,1);days.forEach(d=>d.mistakes.splice(i,1));save();renderLists();}

/* POPUP */
function openPopup(e,id){
 const d=days.find(x=>x.id===id),p=document.getElementById("popup");
 p.style.left=e.pageX+"px";p.style.top=e.pageY+"px";
 let html=`<b>Day ${id}</b><div class='section'><h4>âœ… Habits</h4>`;
 habits.forEach((h,i)=>html+=`<label><input type='checkbox' ${d.checks[i]?"checked":""} onchange='toggleCheck(${id},${i})'>${h}</label><br>`);
 html+="</div><div class='section'><h4>âŒ Behaviors</h4>";
 behaviors.forEach((b,i)=>html+=`<label><input type='checkbox' ${d.mistakes[i]?"checked":""} onchange='toggleMistake(${id},${i})'>${b}</label><br>`);
 html+=`</div><div class='section'>ğŸ¯ Goal Avg <input type='number' id='goal${id}' min='0' max='10' value='${d.goalAvg}'></div>
 <button onclick='saveGoal(${id})'>ğŸ’¾ Save</button>
 <button onclick='finalizeDay(${id})'>âœ… Finalize</button>`;
 p.innerHTML=html;p.style.display="block";
}
window.addEventListener("click",e=>{if(!e.target.closest("#popup"))document.getElementById("popup").style.display="none";});
function toggleCheck(did,i){const d=days.find(x=>x.id===did);d.checks[i]=!d.checks[i];save();}
function toggleMistake(did,i){const d=days.find(x=>x.id===did);d.mistakes[i]=!d.mistakes[i];save();}
function saveGoal(id){const v=parseFloat(document.getElementById("goal"+id).value)||0;const d=days.find(x=>x.id===id);d.goalAvg=Math.max(0,Math.min(10,v));save();}

/* FINALIZE (Pat Riley Formula) */
function finalizeDay(id){
 const d=days.find(x=>x.id===id);
 const g=d.checks.filter(x=>x).length,b=d.mistakes.filter(x=>x).length;
 const hs=habits.length?g/habits.length:0,br=behaviors.length?b/behaviors.length:0,ga=d.goalAvg/10,cons=days.filter(x=>x.finalized).length/totalDays;
 let s=((hs+ga-br)/2*0.7)+(cons*0.3);s=Math.max(0,Math.min(1,s));
 d.score=parseFloat(s.toFixed(2));d.finalized=true;save();renderCalendar();drawChart();
}

/* PLAYER STATS CARD */
function updatePlayerCard(){
 const done=days.filter(d=>d.finalized);
 const avgScore=done.length?done.reduce((a,b)=>a+b.score,0)/done.length:0;
 const avgGoal=done.length?done.reduce((a,b)=>a+b.goalAvg,0)/done.length:0;
 const tHab=done.reduce((a,b)=>a+(b.checks.filter(x=>x).length),0);
 const tMis=done.reduce((a,b)=>a+(b.mistakes.filter(x=>x).length),0);
 document.getElementById("daysDone").textContent=`${done.length} / 90`;
 document.getElementById("avgScore").textContent=avgScore.toFixed(2);
 document.getElementById("avgGoal").textContent=(avgGoal/10).toFixed(2);
 document.getElementById("totalHabits").textContent=tHab;
 document.getElementById("totalMistakes").textContent=tMis;
}

/* CHART */
function toggleChart(){
 const c=document.getElementById("chartContainer");
 c.style.display=c.style.display==="none"?"block":"none";
 if(c.style.display==="block")drawChart();
}
function drawChart(){
 const ctx=document.getElementById("progressChart").getContext("2d");
 if(chart)chart.destroy();
 const f=days.filter(x=>x.finalized);
 chart=new Chart(ctx,{type:"line",
  data:{labels:f.map(d=>d.id),
   datasets:[
     {label:"Pat Riley Score",data:f.map(d=>d.score),borderColor:"#00eaff",fill:false},
     {label:"Goal Avg",data:f.map(d=>d.goalAvg/10),borderColor:"#ff0080",fill:false}
   ]},
  options:{scales:{y:{beginAtZero:true,max:1}},plugins:{legend:{labels:{color:"#fff"}}}}});
}

/* SAVE / LOAD */
function save(){localStorage.setItem("habits",JSON.stringify(habits));
 localStorage.setItem("behaviors",JSON.stringify(behaviors));
 localStorage.setItem("days",JSON.stringify(days));
 renderCalendar();}
function resetData(){if(confirm("Reset all data?")){localStorage.clear();location.reload();}}

renderLists();renderCalendar();
</script>
</body>
</html>
