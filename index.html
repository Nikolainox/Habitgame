<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèí 90 Day Habit Tracker</title>
  <style>
    :root {
      --bg-dark: #0d1826;
      --bg-light: #1d3557;
      --accent: #ffb347;
      --accent2: #ff7700;
      --green: #3bb273;
      --red: #d93746;
      --card: rgba(255,255,255,.08);
      --text: #f4f7fb;
    }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #1d3557, #0d1826);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 1rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255,255,255,.1);
      background: rgba(255,255,255,.05);
      backdrop-filter: blur(8px);
    }
    .title {
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: .3rem;
    }
    .scoreboard {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
    }
    .tile {
      background: var(--card);
      border-radius: 12px;
      padding: .4rem .7rem;
      text-align: center;
      min-width: 90px;
    }
    .tile small {
      display: block;
      font-size: .65rem;
      color: #a8b6d3;
      text-transform: uppercase;
    }
    .tile div {
      font-size: 1rem;
      font-weight: 600;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    .habits {
      background: var(--card);
      border-radius: 12px;
      padding: .8rem;
    }
    .habit {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,.08);
      border-radius: 8px;
      padding: .4rem .6rem;
      margin-bottom: .4rem;
    }
    .btn-del {
      background: rgba(217,55,70,.2);
      border: none;
      border-radius: 8px;
      color: #fff;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    form {
      display: flex;
      gap: .4rem;
    }
    input, button {
      border: none;
      border-radius: 8px;
      padding: .4rem .6rem;
      font-size: .9rem;
    }
    input {
      flex: 1;
      background: rgba(255,255,255,.1);
      color: #fff;
    }
    button {
      background: linear-gradient(120deg,var(--accent),var(--accent2));
      color: #0d1826;
      font-weight: 600;
      cursor: pointer;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px,1fr));
      gap: .7rem;
    }
    .day-card {
      background: var(--card);
      border-radius: 14px;
      padding: .6rem .5rem;
      display: flex;
      flex-direction: column;
      gap: .3rem;
      cursor: pointer;
      transition: transform .15s ease, background .2s;
    }
    .day-card:hover {
      transform: translateY(-3px);
      background: rgba(255,255,255,.12);
    }
    .day-card.finalized { border-left: 4px solid var(--green); }
    .day-card.failed { border-left: 4px solid var(--red); }
    .day-num {
      font-weight: 700;
      font-size: 1rem;
    }
    .stats {
      font-size: .8rem;
      color: #a8b6d3;
      display: flex;
      justify-content: space-between;
    }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal {
      background: #102030;
      border: 1px solid rgba(255,255,255,.2);
      border-radius: 12px;
      padding: 1rem;
      width: min(90%,340px);
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h3 { margin-top: 0; }
    .modal label { display: block; margin-bottom: .4rem; }
    .goal-input { width: 70px; }
    .modal-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: .8rem;
    }
    @media (max-width: 700px) {
      header { flex-direction: column; align-items: flex-start; }
      main { padding: .6rem; }
      .cards { grid-template-columns: repeat(auto-fill, minmax(140px,1fr)); }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <div class="title">üèí 90 Day Habit Tracker</div>
      <small style="color:#a8b6d3;">Seuraa kehityst√§si ‚Äì yksi p√§iv√§ kerrallaan</small>
    </div>
    <div class="scoreboard">
      <div class="tile"><small>Habits</small><div id="sb-habits">0</div></div>
      <div class="tile"><small>Keskiarvo</small><div id="sb-avg">‚Äî</div></div>
      <div class="tile"><small>Pat Riley</small><div id="sb-pr">‚Äî</div></div>
    </div>
  </header>

  <main>
    <section class="habits">
      <h3>Tapasi</h3>
      <div id="habit-list"></div>
      <form id="add-form">
        <input id="habit-input" placeholder="Lis√§√§ uusi tapa..." required />
        <button type="submit">Add</button>
      </form>
    </section>

    <section>
      <h3>Tulostaulu ‚Äì 90 p√§iv√§√§</h3>
      <div class="cards" id="cards"></div>
    </section>
  </main>

  <div class="modal-backdrop" id="modal">
    <div class="modal">
      <h3 id="modal-title"></h3>
      <div id="modal-habits"></div>
      <div style="margin-top:.5rem;">
        <label>Goal %:
          <input type="number" id="goal-input" class="goal-input" min="0" max="100">
        </label>
      </div>
      <div class="modal-buttons">
        <button id="btn-save">Tallenna</button>
        <button id="btn-finalize">Finalize</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "habit90_v3";
    let state = { habits: [], days: {} };
    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    const load = () => {
      const s = localStorage.getItem(STORAGE_KEY);
      if (s) state = JSON.parse(s);
      else {
        state.habits=[{id:"h1",name:"Harjoitus"},{id:"h2",name:"Ravinto"}];
        for(let i=1;i<=90;i++) state.days[i]={checks:{},goal:null,score:null,finalized:false};
        save();
      }
    };

    // Habits
    function renderHabits(){
      const list=document.getElementById("habit-list");
      list.innerHTML="";
      state.habits.forEach(h=>{
        const div=document.createElement("div");
        div.className="habit";
        div.innerHTML=`<span>${h.name}</span><button class="btn-del" data-id="${h.id}">√ó</button>`;
        list.appendChild(div);
      });
      document.querySelectorAll(".btn-del").forEach(b=>b.onclick=()=>{
        const id=b.dataset.id;
        state.habits=state.habits.filter(h=>h.id!==id);
        Object.values(state.days).forEach(d=>delete d.checks[id]);
        save(); renderAll();
      });
      document.getElementById("sb-habits").textContent=state.habits.length;
    }
    document.getElementById("add-form").onsubmit=e=>{
      e.preventDefault();
      const val=document.getElementById("habit-input").value.trim();
      if(!val) return;
      state.habits.push({id:"h"+Math.random().toString(36).slice(2,6),name:val});
      document.getElementById("habit-input").value="";
      save(); renderAll();
    };

    // Cards
    function renderCards(){
      const cont=document.getElementById("cards");
      cont.innerHTML="";
      for(let i=1;i<=90;i++){
        const d=state.days[i];
        const done=Object.values(d.checks).filter(Boolean).length;
        const card=document.createElement("div");
        card.className="day-card";
        if(d.finalized) card.classList.add(d.score>=(d.goal||0)? "finalized":"failed");
        card.innerHTML=`
          <div class="day-num">Day ${i}</div>
          <div class="stats"><span>Done:</span><span>${done}/${state.habits.length}</span></div>
          <div class="stats"><span>Goal:</span><span>${d.goal??"‚Äî"}%</span></div>
          <div class="stats"><span>Score:</span><span>${d.score?d.score.toFixed(0):"‚Äî"}%</span></div>
        `;
        card.onclick=()=>openModal(i);
        cont.appendChild(card);
      }
    }

    // Modal
    const modal=document.getElementById("modal");
    const modalHabits=document.getElementById("modal-habits");
    const goalInput=document.getElementById("goal-input");
    let activeDay=null;

    function openModal(day){
      activeDay=day;
      const d=state.days[day];
      modal.style.display="flex";
      document.getElementById("modal-title").textContent=`Day ${day}`;
      modalHabits.innerHTML="";
      state.habits.forEach(h=>{
        if(!(h.id in d.checks)) d.checks[h.id]=false;
        const row=document.createElement("label");
        row.innerHTML=`<input type="checkbox" data-id="${h.id}" ${d.checks[h.id]?"checked":""}> ${h.name}`;
        modalHabits.appendChild(row);
      });
      goalInput.value=d.goal??"";
      modalHabits.querySelectorAll("input").forEach(c=>c.onchange=()=>{d.checks[c.dataset.id]=c.checked;});
    }
    modal.onclick=e=>{if(e.target===modal) modal.style.display="none";};

    document.getElementById("btn-save").onclick=()=>{
      const d=state.days[activeDay];
      d.goal=+goalInput.value||null;
      d.finalized=false;
      save(); modal.style.display="none"; renderAll();
    };
    document.getElementById("btn-finalize").onclick=()=>{
      const d=state.days[activeDay];
      const done=Object.values(d.checks).filter(Boolean).length;
      const total=state.habits.length||1;
      d.score=(done/total)*100;
      d.goal=+goalInput.value||null;
      d.finalized=true;
      save(); modal.style.display="none"; renderAll();
    };

    // Scoreboard
    function getAvg(){
      const finals=Object.values(state.days).filter(d=>d.finalized && d.score!=null);
      if(!finals.length)return null;
      return finals.reduce((a,b)=>a+b.score,0)/finals.length;
    }
    function updateScoreboard(){
      const avg=getAvg();
      document.getElementById("sb-avg").textContent=avg?avg.toFixed(1)+"%":"‚Äî";
      const finals=Object.values(state.days).filter(d=>d.finalized && d.score!=null);
      if(finals.length<2){document.getElementById("sb-pr").textContent="‚Äî";return;}
      const last=finals[finals.length-1].score;
      const prevAvg=finals.slice(0,-1).reduce((a,b)=>a+b.score,0)/(finals.length-1);
      const diff=((last-prevAvg)/prevAvg)*100;
      document.getElementById("sb-pr").textContent=(diff>=0?"+":"")+diff.toFixed(1)+"%";
    }

    function renderAll(){ renderHabits(); renderCards(); updateScoreboard(); }
    load(); renderAll();
  </script>
</body>
</html>
