<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèí 90 Day Scoreboard</title>
<style>
:root {
  --bg: #0a0f1a;
  --panel: #121c2c;
  --accent: #ffb347;
  --accent2: #ff7700;
  --green: #2ecc71;
  --red: #e74c3c;
  --text: #f4f7fb;
  --muted: #8da4c7;
}
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle at top, #1b2b4b, var(--bg));
  color: var(--text);
}
header {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: var(--panel);
  border-bottom: 2px solid rgba(255,255,255,.05);
  box-shadow: 0 2px 10px rgba(0,0,0,.4);
}
.title {
  font-size: 1.4rem;
  font-weight: 700;
}
.scoreboard {
  display: flex;
  gap: .6rem;
  flex-wrap: wrap;
}
.tile {
  background: rgba(255,255,255,.07);
  border-radius: 10px;
  padding: .5rem .8rem;
  text-align: center;
  min-width: 90px;
}
.tile small {
  display: block;
  color: var(--muted);
  font-size: .65rem;
  text-transform: uppercase;
}
.tile div {
  font-weight: 600;
  font-size: 1rem;
}
main {
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
section {
  background: rgba(255,255,255,.05);
  border-radius: 12px;
  padding: 1rem;
  box-shadow: inset 0 0 15px rgba(255,255,255,.05);
}
.habit {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255,255,255,.08);
  border-radius: 8px;
  padding: .4rem .6rem;
  margin-bottom: .4rem;
}
.btn-del {
  border: none;
  border-radius: 8px;
  background: rgba(231,76,60,.3);
  color: #fff;
  width: 24px;
  height: 24px;
  cursor: pointer;
}
form {
  display: flex;
  gap: .4rem;
}
input, button {
  border: none;
  border-radius: 8px;
  padding: .45rem .6rem;
}
input {
  flex: 1;
  background: rgba(255,255,255,.1);
  color: var(--text);
}
button {
  background: linear-gradient(120deg, var(--accent), var(--accent2));
  color: #000;
  font-weight: 700;
  cursor: pointer;
}
.table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border-bottom: 1px solid rgba(255,255,255,.08);
  padding: .5rem;
  text-align: center;
}
tr.finalized { background: rgba(46,204,113,.15); }
tr.failed { background: rgba(231,76,60,.15); }
.day-row {
  cursor: pointer;
  transition: background .15s;
}
.day-row:hover { background: rgba(255,255,255,.08); }

/* MODAL */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 50;
}
.modal {
  background: #121c2c;
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 12px;
  padding: 1rem;
  width: min(90%, 360px);
  box-shadow: 0 8px 30px rgba(0,0,0,.6);
}
.modal h3 { margin-top: 0; }
.modal label { display: block; margin-bottom: .4rem; }
.stats-box {
  background: rgba(255,255,255,.05);
  border-radius: 10px;
  padding: .5rem .8rem;
  margin-top: .6rem;
}
.stat-line {
  display: flex;
  justify-content: space-between;
  font-size: .85rem;
  color: var(--muted);
  margin-bottom: .2rem;
}
.stat-value {
  font-weight: 600;
  color: var(--text);
}
.modal-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 1rem;
}
.goal-input { width: 80px; }
@media (max-width:700px){
  .scoreboard{justify-content:center;}
  th,td{font-size:.8rem;}
}
</style>
</head>
<body>
<header>
  <div class="title">üèí 90 Day Scoreboard</div>
  <div class="scoreboard">
    <div class="tile"><small>Habits</small><div id="sb-habits">0</div></div>
    <div class="tile"><small>Keskiarvo</small><div id="sb-avg">‚Äî</div></div>
    <div class="tile"><small>Pat Riley</small><div id="sb-pr">‚Äî</div></div>
  </div>
</header>

<main>
  <section>
    <h3>Tavat</h3>
    <div id="habit-list"></div>
    <form id="add-form">
      <input id="habit-input" placeholder="Lis√§√§ tapa..." required>
      <button type="submit">Add</button>
    </form>
  </section>

  <section>
    <h3>90 p√§iv√§n tulostaulu</h3>
    <table class="table" id="day-table">
      <thead><tr><th>P√§iv√§</th><th>Done</th><th>Goal %</th><th>Score %</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<div class="modal-backdrop" id="modal">
  <div class="modal">
    <h3 id="modal-title"></h3>
    <div id="modal-habits"></div>
    <div style="margin-top:.6rem;">
      <label>Goal %:
        <input type="number" id="goal-input" class="goal-input" min="0" max="100">
      </label>
    </div>

    <div class="stats-box">
      <div class="stat-line"><span>Done:</span><span class="stat-value" id="stat-done">‚Äî</span></div>
      <div class="stat-line"><span>Score:</span><span class="stat-value" id="stat-score">‚Äî</span></div>
      <div class="stat-line"><span>Pat Riley:</span><span class="stat-value" id="stat-pr">‚Äî</span></div>
      <div class="stat-line"><span>Status:</span><span class="stat-value" id="stat-status">‚Äî</span></div>
    </div>

    <div class="modal-buttons">
      <button id="btn-save">Tallenna</button>
      <button id="btn-finalize">Finalize</button>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY="habit90_v4";
let state={habits:[],days:{}};
const save=()=>localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
const load=()=>{
  const s=localStorage.getItem(STORAGE_KEY);
  if(s) state=JSON.parse(s);
  else {
    state.habits=[{id:"h1",name:"Harjoitus"},{id:"h2",name:"Ravinto"}];
    for(let i=1;i<=90;i++) state.days[i]={checks:{},goal:null,score:null,finalized:false};
    save();
  }
};

// Habits
function renderHabits(){
  const list=document.getElementById("habit-list");
  list.innerHTML="";
  state.habits.forEach(h=>{
    const div=document.createElement("div");
    div.className="habit";
    div.innerHTML=`<span>${h.name}</span><button class="btn-del" data-id="${h.id}">√ó</button>`;
    list.appendChild(div);
  });
  document.querySelectorAll(".btn-del").forEach(b=>b.onclick=()=>{
    const id=b.dataset.id;
    state.habits=state.habits.filter(h=>h.id!==id);
    Object.values(state.days).forEach(d=>delete d.checks[id]);
    save(); renderAll();
  });
  document.getElementById("sb-habits").textContent=state.habits.length;
}
document.getElementById("add-form").onsubmit=e=>{
  e.preventDefault();
  const val=document.getElementById("habit-input").value.trim();
  if(!val)return;
  state.habits.push({id:"h"+Math.random().toString(36).slice(2,6),name:val});
  document.getElementById("habit-input").value="";
  save(); renderAll();
};

// Table
function renderTable(){
  const tbody=document.querySelector("#day-table tbody");
  tbody.innerHTML="";
  for(let i=1;i<=90;i++){
    const d=state.days[i];
    const done=Object.values(d.checks).filter(Boolean).length;
    const tr=document.createElement("tr");
    tr.className="day-row";
    if(d.finalized) tr.classList.add(d.score>=(d.goal||0)? "finalized":"failed");
    tr.innerHTML=`<td>Day ${i}</td><td>${done}/${state.habits.length}</td>
      <td>${d.goal??"‚Äî"}%</td><td>${d.score?d.score.toFixed(0):"‚Äî"}%</td>
      <td>${d.finalized?"‚úî":"‚Äî"}</td>`;
    tr.onclick=()=>openModal(i);
    tbody.appendChild(tr);
  }
}

// Modal logic
const modal=document.getElementById("modal");
const modalHabits=document.getElementById("modal-habits");
const goalInput=document.getElementById("goal-input");
let activeDay=null;

function openModal(day){
  activeDay=day;
  const d=state.days[day];
  modal.style.display="flex";
  document.getElementById("modal-title").textContent="Day "+day;
  modalHabits.innerHTML="";
  state.habits.forEach(h=>{
    if(!(h.id in d.checks)) d.checks[h.id]=false;
    const row=document.createElement("label");
    row.innerHTML=`<input type="checkbox" data-id="${h.id}" ${d.checks[h.id]?"checked":""}> ${h.name}`;
    modalHabits.appendChild(row);
  });
  goalInput.value=d.goal??"";
  modalHabits.querySelectorAll("input").forEach(c=>c.onchange=()=>{d.checks[c.dataset.id]=c.checked;updateStatsBox();});
  updateStatsBox();
}
modal.onclick=e=>{if(e.target===modal) modal.style.display="none";};

document.getElementById("btn-save").onclick=()=>{
  const d=state.days[activeDay];
  d.goal=+goalInput.value||null;
  d.finalized=false;
  save(); modal.style.display="none"; renderAll();
};
document.getElementById("btn-finalize").onclick=()=>{
  const d=state.days[activeDay];
  const done=Object.values(d.checks).filter(Boolean).length;
  const total=state.habits.length||1;
  d.score=(done/total)*100;
  d.goal=+goalInput.value||null;
  d.finalized=true;
  save(); modal.style.display="none"; renderAll();
};

function updateStatsBox(){
  const d=state.days[activeDay];
  const done=Object.values(d.checks).filter(Boolean).length;
  const total=state.habits.length||1;
  const score=(done/total)*100;
  const avg=getAvg();
  const pr=avg?((score-avg)/avg*100).toFixed(1)+"%":"‚Äî";
  document.getElementById("stat-done").textContent=`${done}/${total}`;
  document.getElementById("stat-score").textContent=isNaN(score)? "‚Äî" : score.toFixed(0)+"%";
  document.getElementById("stat-pr").textContent=pr;
  document.getElementById("stat-status").textContent=d.finalized?"Finalized":"Draft";
}

// Scoreboard
function getAvg(){
  const finals=Object.values(state.days).filter(d=>d.finalized && d.score!=null);
  if(!finals.length)return null;
  return finals.reduce((a,b)=>a+b.score,0)/finals.length;
}
function updateScoreboard(){
  const avg=getAvg();
  document.getElementById("sb-avg").textContent=avg?avg.toFixed(1)+"%":"‚Äî";
  const finals=Object.values(state.days).filter(d=>d.finalized && d.score!=null);
  if(finals.length<2){document.getElementById("sb-pr").textContent="‚Äî";return;}
  const last=finals[finals.length-1].score;
  const prevAvg=finals.slice(0,-1).reduce((a,b)=>a+b.score,0)/(finals.length-1);
  const diff=((last-prevAvg)/prevAvg)*100;
  document.getElementById("sb-pr").textContent=(diff>=0?"+":"")+diff.toFixed(1)+"%";
}

function renderAll(){ renderHabits(); renderTable(); updateScoreboard(); }
load(); renderAll();
</script>
</body>
</html>
